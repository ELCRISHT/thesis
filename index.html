<!doctype html>
<html lang="en">
<head>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>IntelliGrade</title>
  <link rel="stylesheet" href="styles.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js/dist/chart.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="IntelliGrade.png" alt="LSPU logo" class="logo"/>
      <div>
        <h1>IntelliGrade</h1>
        <p class="subtitle">DevCo-BLV</p>
      </div>
    </div>
    <nav class="nav">
      <button class="nav-btn active">Dashboard</button>
      <button class="nav-btn" id="reportsBtn">Download Reports</button>
      <button class="nav-btn">Settings</button>
      <button class="nav-btn" id="logoutButton">Logout</button>
    </nav>
  </header>
  <main class="container">
    <section class="controls">
      <label for="studentSelect"><strong>Select Student:</strong></label>
      <select id="studentSelect"></select>
      <button id="loadBtn">Load</button>
    </section>

    <section class="cards">
      <div class="card">
        <h3>AI Dependency Index</h3>
        <p id="aiIndex" class="big">—</p>
      </div>
      <div class="card">
        <h3>Predicted Risk</h3>
        <p id="riskStatus" class="big">—</p>
      </div>
      <div class="card">
        <h3>Performance Level</h3>
        <p id="avgGrade" class="big">—</p>
      </div>
      <div class="card">
        <h3>Total Respondents</h3>
        <p id="totalResp" class="big">—</p>
      </div>
    </section>

    <section class="charts">
      <div class="chart-card">
        <h4>Dependency Domains</h4>
        <canvas id="barChart"></canvas>
      </div>
      <div class="chart-card">
        <h4>Dependency Score Per College</h4>
        <canvas id="lineChart"></canvas>
      </div>
      <div class="chart-card">
        <h4>Risk Distribution</h4>
        <canvas id="pieChart"></canvas>
      </div>
      <div class="chart-card">
        <h4>AI Dependency by Year Level</h4>
        <canvas id="yearLevelChart"></canvas>
      </div>
    </section>
  </main>

  <footer class="footer">IntelliGrade • All Rights Reserved. • DevCo-BLV (2025)</footer>

  <!-- REPORT MODAL -->
<div id="reportModal" class="modal hidden">
  <div class="modal-content">
    <h2>Download Reports</h2>

    <p>Select report type:</p>

    <button id="downloadSelectedPDF" class="modal-btn">Download Selected Student (PDF)</button>
    <button id="downloadCSV" class="modal-btn">Download All Students (CSV)</button>

    <button id="closeReportModal" class="modal-close">Close</button>
  </div>
</div>

<!-- SETTINGS MODAL -->
<div id="settingsModal" class="modal hidden">
  <div class="modal-content">
    <h2>Settings</h2>

    <label>Theme</label>
    <select id="themeSelect">
      <option value="light">Light</option>
      <option value="dark">Dark</option>
    </select>

    <label>Notification Preference</label>
    <select id="notifSelect">
      <option value="enabled">Enabled</option>
      <option value="disabled">Disabled</option>
    </select>

    <button id="saveSettings" class="modal-btn">Save Settings</button>
    <button id="closeSettingsModal" class="modal-close">Close</button>
  </div>
</div>

<script>
  document.querySelectorAll('.nav-btn')[0].id = "dashboardBtn";
  document.querySelectorAll('.nav-btn')[2].id = "settingsBtn";
</script>
  <script type="module" src="firebase-init.js"></script>
  <script type="module" src="auth.js"></script>

  <script type="module">
    import { attachAuthGuard, doSignOut } from './auth.js';

    // Protect page and then load dashboard logic
    attachAuthGuard({
      onAuthVerified: async (user) => {
        // Show username or perform small UI updates if needed
        document.querySelector('.brand h1').textContent = 'IntelliGrade';

        // wire logout button
        const logoutBtn = document.getElementById('logoutButton');
        if (logoutBtn) {
          logoutBtn.addEventListener('click', async () => {
            await doSignOut();
            window.location.href = 'login.html';
          });
        }

        // dynamically import app.js after auth confirmed (so app can rely on authenticated state)
        try {
          await import('./app.js');
        } catch (err) {
          console.error('Failed to load app.js', err);
        }
      },
      onNotAuth: () => {
        window.location.href = 'login.html';
      }
    });
  </script>
</body>
</html>
